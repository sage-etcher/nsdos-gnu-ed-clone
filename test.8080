;GNU ED CLONE FOR NORTHSTAR DISK OPERATING SYSTEM
;REFERENCES FILE 'NSDOS-PROC.ASM' FOR MANY OS CALLS AND CONSTANTS
;
;SAGE I HENDRICKS
;2023 NOV 13


;CONSTANTS
NULL	EQU	000H	;NULL BYTE
NULLPTR	EQU	00000H	;NULL WORD

CR	EQU	00AH
LF	EQU	00DH


;CODE PORTION
	ORG	TPA
MAIN:	CALL	PHW		;PRINT HELLO WORLD
	
	;FALL THROUGH	
EXIT:	CALL	DOS		;RETURN CONTROL TO DOS/EXIT
	;FALL THROUGH
	;FATAL ERROR IF REACHED, CONTINUOUS HALT TO PROTECT THE SYSTEM
HALT:	HLT			;HALT THE SYSTEM, IN THE CASE OF AN ERROR
	JMP	HALT		;CONTINUOUSLY

PUTCH:	; B = CHAR
	PUSH	D
	MVI	A,STDOUT	;OUTPUT TO STDOUT
	CALL	COUT		;OUTPUT CHAR (B) TO STDOUT
	POP	D
	RET

PRINT:	; DE = NULL TERMINATED STRING
	LDAX	D		;GET CURRENT CHAR
	CPI	NULL		;CHECK IF CHARACTER IS NULL
	RZ			;IF IT IS, WE ARE DONE, RETURN
	MOV	B,A		;OTHERWISE, PREPARE THE CHAR FOR PUTCH
	CALL	PUTCH		;PRINT CHARACTER TO STDOUT
	INX	D		;MOVE TO THE NEXT CHARACTER
	JMP	PRINT		;REPEAT UNTIL A NULL IS FOUND
PHW:	LXI	D,HELLO		;LOAD HELLO STRING ADDR
	CALL	PRINT		;PRINT THE STRING
	RET	


;DATA PORTION
HELLO:	DB	'HELLO, WORLD!',CR,LF,NULL

	END
