;NSDOS STRING OUTPUT PROCEDURE
;
;SAGE I HENDRICKS
;2023 NOV 14


;CONSTANTS
TPA	EQU	00000H		;TRANSIENT PROGRAM AREA

NSBASE	EQU	0F700H		;BASE OF NSGDOS PROCEDURES
COUT	EQU	NSBASE+0010DH	;CHARACTER OUTPUT 
DOS	EQU	NSBASE+00128H	;DOS ENTRY-POINT

CON0	EQU	000H		;CONSOLE DEVICE ID

NULL	EQU	000H	;NULL BYTE
LF	EQU	00AH	;LINE-FEED
CR	EQU	00DH	;CARTIDGE-RETURN


;CODE PORTION
	ORG	TPA
	JMP	MAIN		;GOTO MAIN PROCDURE

	DB	' COPYRIGHT 2023 SAGE I. HENDRICKS '

MAIN:	LXI	D,HELLO		;PRINT PARAM STRING ADDR
	CALL	PRINT		;PRINT HELLO WORLD STRING

	;FALL THROUGH
EXIT:	CALL	DOS		;RETURN CONTROL TO DOS/EXIT
	;FALL THROUGH
	;FATAL ERROR IF REACHED, CONTINUOUS HALT TO PROTECT THE SYSTEM
HALT:	HLT			;HALT THE SYSTEM, IN THE CASE OF AN ERROR
	JMP	HALT		;CONTINUOUSLY

PUTCH:	;B=CHAR
	PUSH	D
	MVI	A,CON0		;SET OUTPUT DEVICE AS CON0
	CALL	COUT		;OUTPUT CHAR (B) TO CON0
	POP	D
	RET

PRINT:	;DE=NULL TERMINATED STRING
	LDAX	D		;GET CURRENT CHAR
	CPI	NULL		;CHECK IF CHARACTER IS NULL
	RZ			;IF IT IS, WE ARE DONE, RETURN
	MOV	B,A		;OTHERWISE, PREPARE THE CHAR FOR PUTCH
	CALL	PUTCH		;PRINT CHARACTER TO STDOUT
	INX	D		;MOVE TO THE NEXT CHARACTER
	JMP	PRINT		;REPEAT UNTIL A NULL IS FOUND

;DATA PORTION
HELLO:	DB	'HELLO, WORLD',CR,LF,NULL

	END
